<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>素数判定ゲーム ～君の素数センサーは優秀か？～</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f8ff; }
  h1 { color: #2c3e50; }
  #number { font-size: 4em; font-weight: bold; margin: 40px; color: #e74c3c; }
  .buttons { margin: 40px; }
  button { font-size: 1.5em; padding: 15px 40px; margin: 10px; cursor: pointer; }
  #prime { background: #27ae60; color: white; border: none; border-radius: 10px; }
  #notprime { background: #c0392b; color: white; border: none; border-radius: 10px; }
  #result { font-size: 2em; margin: 30px; }
  .hidden { display: none; }
</style>
</head>
<body>
  <h1>素数判定ゲーム</h1>
  <p>表示された数字は素数だと思いますか？</p>
  <div id="number">????</div>
  
  <div class="buttons">
    <button id="prime">素数！</button>
    <button id="notprime">素数じゃない！</button>
  </div>
  
  <div id="result"></div>
  <div id="final" class="hidden">
    <h2>10問終了！お疲れ様でした！</h2>
    <p>結果を送信中...</p>
  </div>

<script>
// === 設定 ===
const TOTAL_QUESTIONS = 10;
const EMAIL_TO = "sakirubymiku@gmail.com";
const EMAIL_SUBJECT = "素数判定ゲーム結果 " + new Date().toLocaleString('ja-JP');

// 結果保存用
let results = [];
let currentQuestion = 0;

// 4～6桁のランダム奇数生成
function randomOddNumber() {
  const min = 1000;     // 4桁
  const max = 999999;   // 6桁
  let num;
  do {
    num = Math.floor(Math.random() * (max - min + 1)) + min;
  } while (num % 2 === 0 || num % 5 === 0); // 明らかに割り切れる数は除外（少し難易度調整）
  return num + (num % 2 === 0 ? 1 : 0); // 確実に奇数にする
}

// ミラー法による素数判定（十分高速）
function isPrime(n) {
  if (n <= 1) return false;
  if (n <= 3) return true;
  if (n % 2 === 0 || n % 3 === 0) return false;
  for (let i = 5; i * i <= n; i += 6) {
    if (n % i === 0 || n % (i + 2) === 0) return false;
  }
  return true;
}

// 新しい問題を出す
function nextQuestion() {
  if (currentQuestion >= TOTAL_QUESTIONS) {
    endGame();
    return;
  }
  
  currentQuestion++;
  const num = randomOddNumber();
  const prime = isPrime(num);
  
  document.getElementById("number").textContent = num;
  document.getElementById("result").textContent = 
    `第 ${currentQuestion} 問 / 全 ${TOTAL_QUESTIONS} 問`;
  
  // 現在の問題情報を一時保存
  window.currentNum = num;
  window.currentIsPrime = prime;
}

// 回答処理
function answer(isUserThinkPrime) {
  const num = window.currentNum;
  const actual = window.currentIsPrime;
  const correct = (isUserThinkPrime === actual);
  
  results.push({
    question: currentQuestion,
    number: num,
    isPrime: actual,
    userAnswer: isUserThinkPrime,
    correct: correct
  });
  
  nextQuestion();
}

// ゲーム終了＆メール送信
function endGame() {
  document.querySelector(".buttons").classList.add("hidden");
  document.getElementById("final").classList.remove("hidden");
  
  // 結果表作成
  let table = "問題,数字,実際は素数,あなたの回答,正解/不正解\n";
  let correctCount = 0;
  results.forEach(r => {
    const actualStr = r.isPrime ? "素数" : "合成数";
    const userStr = r.userAnswer ? "素数" : "合成数";
    const judge = r.correct ? "○" : "×";
    if (r.correct) correctCount++;
    table += `${r.question},${r.number},${actualStr},${userStr},${judge}\n`;
  });
  table += `\n正答率: ${correctCount}/${TOTAL_QUESTIONS} (${Math.round(correctCount/TOTAL_QUESTIONS*100)}%)\n`;
  table += `終了時刻: ${new Date().toLocaleString('ja-JP')}\n`;
  table += `ユーザーエージェント: ${navigator.userAgent}\n`;
  
  const body = encodeURIComponent(table);
  const mailtoLink = `mailto:${EMAIL_TO}?subject=${encodeURIComponent(EMAIL_SUBJECT)}&body=${body}`;
  
  // 自動でメールソフトを開く（これが最強の送信方法）
  const a = document.createElement('a');
  a.href = mailtoLink;
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  
  // バックアップとしてコンソールにも出力
  console.log("=== 素数判定ゲーム結果 ===\n" + table);
  
  document.getElementById("final").innerHTML = `
    <h2>お疲れ様でした！</h2>
    <p>正答数: <b>${correctCount}/${TOTAL_QUESTIONS}</b></p>
    <p style="color: #27ae60;">結果は自動でメールにまとめられました！<br>
    「送信」ボタンを押して sakirubymiku@gmail.com まで送ってね♪</p>
  `;
}

// ボタン設定
document.getElementById("prime").onclick = () => answer(true);
document.getElementById("notprime").onclick = () => answer(false);

// ゲーム開始
window.onload = () => {
  nextQuestion();
};
</script>
</body>
</html>